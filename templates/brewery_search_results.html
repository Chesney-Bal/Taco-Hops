<!-- {% extends "base.html" %}

{% block title %}Search By Brewery{% endblock %}

{% block body %}  -->

<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>Search by brewery and display map</title>

    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">

    <link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>


  </head>

  <body> 
    <div class="container">
      TODO:
      loop through breweries for coordsinates 
      make a list of lists of lng, lat
      markers will be the breweries from the search
      pop ups will have brewery name, display address, link for tacos?

      <!-- DONE:
      add script from display_map here
      center of map should be search location's coordinates (e.g. North Park) -->
    

    

    </div>

    <div class ="container">
        
      <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 10; bottom: 1; right: 0; left: 10; width: 50%; height: 70%; }
      </style>
    
      <div id="map"></div>
      <h4>This should be center long/lat:{{center}}</h4>
      
      brewery_marker_list=[]
      {% for brewery in breweries %}
        brewery_marker_list.push([{{brewery['coordinates']['longitude']}},{{brewery['coordinates']['latitude']}}]);
      {% endfor %}

      <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiY2hlc25leWJhbCIsImEiOiJjbGMwdXY3eWg0Z2liM3hsY2Uwcm5jcWpwIn0.B2XNvVgPluaaVx9aR3miqw';
        const map = new mapboxgl.Map({
          container: 'map', // container ID
          // Choose from Mapbox's core styles, or make your own style with Mapbox Studio
          style: 'mapbox://styles/mapbox/streets-v12', // style URL
          // center: [-117.1611, 32.7157], // starting position [lng, lat]
          center:{{center}},
          zoom: 12 // starting zoom
        });
        
        const eppig_lng=-117.22766660410099
        const eppig_lat=32.72286208649556
        const marker_list=[eppig_lng, eppig_lat]

        const marker = new mapboxgl.Marker()
        .setLngLat(marker_list)
        .setPopup(new mapboxgl.Popup().setHTML("<h4>BEER</h4>")) // add popup
        .addTo(map);
        


      </script>


      
    </div>

<div class="container">
  <h2>Taco Hop Brewery Search Results:</h2>

  {% for brewery in breweries %}
  <div class="coordinates" data-lat="{{brewery['coordinates']['latitude']}}" data-long="{{brewery['coordinates']['longitude']}}">
    <div class="row">
      <div class="col-6">
        <ul class="brewery-results"></ul>
        <li><a href="{{brewery['url']}}" target="_blank">
          {{brewery['name']}} </a></li>
      </div>
    </div>  
  
    <div class="row">
      <div class="col-5">
        <img src="{{brewery['image_url']}}" width="200">
      </div>
    </div>

    <div class="row">
      <div class="column">
        <p>these are coordinates. lng={{brewery['coordinates']['longitude']}}. lat={{brewery['coordinates']['latitude']}} </p>

      </div>
    </div>

    <div class="row">
      <div class="column">    
        <p>See What Taco Shops are nearby: 
          <a href="/taco?lat={{brewery['coordinates']['latitude']}}&long={{brewery['coordinates']['longitude']}}&name={{brewery['name']}}" target="_blank" method="post" >
            {{brewery['location']['display_address']}}
          </a> 
        </p>
      </div>
    </div>
  </div>
  {% endfor %}



</div>


</body>
<!-- {% endblock %} -->